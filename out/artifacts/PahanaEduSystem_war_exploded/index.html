<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
<!-- Login Overlay -->
<div id="loginOverlay" class="login-overlay">
    <div class="login-container">
        <div class="text-center mb-4">
            <h2 class="text-white mb-1">Welcome To</h2>
            <h1 class="text-white mb-4">Pahana Edu Bookshop</h1>
            <h4 class="text-white-50">Admin Portal</h4>
        </div>
        
        <div class="card shadow-lg">
            <div class="card-body p-4">
                <h3 class="text-center mb-4">Sign In</h3>
                <div id="loginError" class="alert alert-danger" style="display: none;"></div>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                            <input type="text" class="form-control" id="username" placeholder="Enter your username" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="password" class="form-label">Password</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                            <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 py-2 mb-3">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
                    </button>
                </form>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <p class="text-white-50 small"> 2025 Pahana Edu Bookshop. All rights reserved.</p>
        </div>
    </div>
</div>

<style>
:root {
    --primary-color: #6a11cb;
    --secondary-color: #2575fc;
}

.login-overlay {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    padding: 20px;
}

.login-container {
    width: 100%;
    max-width: 420px;
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.card {
    border: none;
    border-radius: 12px;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15) !important;
}

.btn-primary {
    background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    border: none;
    font-weight: 500;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(106, 17, 203, 0.4);
}

.form-control, .input-group-text {
    border-color: #e0e0e0;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.25rem rgba(106, 17, 203, 0.15);
}

.input-group-text {
    background-color: #f8f9fa;
    color: #6c757d;
}

/* Responsive adjustments */
@media (max-width: 576px) {
    .login-container {
        padding: 0 15px;
    }
    
    .card {
        border-radius: 10px;
    }
}

/* Hide main content when not authenticated */
body:not(.authenticated) #sidebar, 
body:not(.authenticated) #content {
    display: none !important;
}

body.authenticated #loginOverlay {
    display: none !important;
}
</style>
<!-- Sidebar -->
<nav id="sidebar">
    <div class="sidebar-header d-flex align-items-center justify-content-between">
        <h3 class="text-white mb-0">Pahana Edu</h3>
        <button class="btn btn-sm btn-outline-light d-md-none" id="sidebarCollapse">
            <i class="bi bi-x"></i>
        </button>
    </div>

    <ul class="sidebar-menu">
        <li>
            <a href="#dashboard" class="active">
                <i class="bi bi-speedometer2"></i>
                <span>Dashboard</span>
            </a>
        </li>
        <li>
            <a href="#customers">
                <i class="bi bi-people-fill"></i>
                <span>Customers</span>
            </a>
        </li>
        <li>
            <a href="#items">
                <i class="bi bi-box-seam"></i>
                <span>Items</span>
            </a>
        </li>
        <li>
            <a href="#billing">
                <i class="bi bi-receipt"></i>
                <span>Billing</span>
            </a>
        </li>
        <li>
            <a href="#orders">
                <i class="bi bi-cart-check"></i>
                <span>Manage Orders</span>
            </a>
        </li>
        <li>
            <a href="#help">
                <i class="bi bi-question-circle"></i>
                <span>Help</span>
            </a>
        </li>
        <li class="nav-item">
            <a>
            <button class="btn btn-link nav-link text-start w-100 text-decoration-none" id="logoutBtn" style="border: none; background: none; cursor: pointer; color: #adb5bd">
                <i class="bi bi-box-arrow-right"></i>
                <span>Logout</span>
            </button>
            </a>
        </li>
    </ul>
</nav>

<!-- Page Content -->
<div id="content">

    <nav class="navbar navbar-expand header-nav">
        <div class="container-fluid">
            <button class="btn btn-link d-md-none" id="sidebarToggle">
                <i class="bi bi-list"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section">
            <div class="mb-4">
                <h2 class="mb-0">Dashboard</h2>
            </div>


            <div id="dashboardLoading" class="text-center py-5" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading dashboard data...</p>
            </div>


            <div id="dashboardStats" class="row">
                <!-- Row 1 -->
                <div class="col-12 col-md-6 mb-4">
                    <div class="card stat-card bg-primary bg-opacity-10 border-0 h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between h-100">
                                <div>
                                    <h6 class="text-muted mb-2">Total Revenue</h6>
                                    <h3 id="totalRevenue">LKR 0.00</h3>
                                </div>
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-currency-dollar card-icon text-primary" style="font-size: 2rem;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 mb-4">
                    <div class="card stat-card bg-success bg-opacity-10 border-0 h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between h-100">
                                <div>
                                    <h6 class="text-muted mb-2">Total Customers</h6>
                                    <h3 id="totalCustomers">0</h3>
                                </div>
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-people-fill card-icon text-success" style="font-size: 2rem;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Row 2 -->
                <div class="col-12 col-md-6 mb-4">
                    <div class="card stat-card bg-warning bg-opacity-10 border-0 h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between h-100">
                                <div>
                                    <h6 class="text-muted mb-2">Total Orders</h6>
                                    <h3 id="totalOrders">0</h3>
                                </div>
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-cart card-icon text-warning" style="font-size: 2rem;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 mb-4">
                    <div class="card stat-card bg-info bg-opacity-10 border-0 h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between h-100">
                                <div>
                                    <h6 class="text-muted mb-2">Active Items</h6>
                                    <h3 id="activeItems">0</h3>
                                </div>
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-box-seam card-icon text-info" style="font-size: 2rem;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Customers Section -->
        <section id="customers" class="content-section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">Customers</h2>
                <div>
                    <button id="addCustomerBtn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#customerModal">
                        <i class="bi bi-plus"></i> Add Customer
                    </button>
                </div>
            </div>

            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Search Customer</h6>
                    <form class="w-100" onsubmit="return false;">
                      <div class="row g-2 align-items-center justify-content-end">
                        <div class="col-12 col-sm-6 col-md-3 col-xl-2">
                          <input id="searchAcc" type="text" class="form-control form-control-sm" placeholder="Account No">
                        </div>
                        <div class="col-12 col-sm-6 col-md-3 col-xl-2">
                          <input id="searchName" type="text" class="form-control form-control-sm" placeholder="Name">
                        </div>
                        <div class="col-12 col-sm-6 col-md-3 col-xl-2">
                          <input id="searchEmail" type="text" class="form-control form-control-sm" placeholder="Email">
                        </div>
                        <div class="col-12 col-sm-6 col-md-3 col-xl-2">
                          <input id="searchPhone" type="text" class="form-control form-control-sm" placeholder="Phone">
                        </div>
                        <div class="col-auto">
                          <button id="searchCustomersBtn" class="btn btn-sm btn-outline-secondary" type="button">
                            <i class="bi bi-search"></i>
                          </button>
                          <button id="clearCustomersBtn" class="btn btn-sm btn-outline-secondary ms-1" type="button" title="Clear">
                            <i class="bi bi-x-lg"></i>
                          </button>
                        </div>
                      </div>
                    </form>
                </div>
                <div class="card-body">
                    <div id="customerAlerts" class="mb-3"></div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
<!--                                <th>ID</th>-->
                                <th>Account No</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Orders</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody id="customerTable"></tbody>
                        </table>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div class="text-muted">
                            Showing 1 to 3 of 15 entries
                        </div>
                        <nav>
                            <ul class="pagination pagination-sm mb-0">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </section>

        <!-- Items Section -->
        <section id="items" class="content-section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">Items</h2>
                <div>
                    <button class="btn btn-primary" id="addItemBtn">
                        <i class="bi bi-plus"></i> Add Item
                    </button>
                </div>
            </div>

            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h6 class="mb-0">Search Items</h6>
                    <form class="w-100 mt-3" onsubmit="return false;">
                        <div class="row g-2 align-items-center">
                            <div class="col-12 col-sm-6 col-md-3 col-xl-2">
                                <input id="searchItemCode" type="text" class="form-control form-control-sm" placeholder="Item Code">
                            </div>
                            <div class="col-12 col-sm-6 col-md-3 col-xl-2">
                                <input id="searchItemName" type="text" class="form-control form-control-sm" placeholder="Name">
                            </div>
                            <div class="col-6 col-md-3 col-xl-2">
                                <input id="searchMinPrice" type="number" step="0.01" class="form-control form-control-sm" placeholder="Min Price">
                            </div>
                            <div class="col-6 col-md-3 col-xl-2">
                                <input id="searchMaxPrice" type="number" step="0.01" class="form-control form-control-sm" placeholder="Max Price">
                            </div>
                            <div class="col-6 col-md-3 col-xl-2">
                                <input id="searchMinQty" type="number" class="form-control form-control-sm" placeholder="Min Qty">
                            </div>
                            <div class="col-6 col-md-3 col-xl-2">
                                <input id="searchMaxQty" type="number" class="form-control form-control-sm" placeholder="Max Qty">
                            </div>
                            <div class="col-auto">
                                <button id="searchItemsBtn" class="btn btn-sm btn-outline-secondary" type="button">
                                    <i class="bi bi-search"></i>
                                </button>
                                <button id="clearItemsBtn" class="btn btn-sm btn-outline-secondary ms-1" type="button" title="Clear">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-body">
                    <div id="itemAlerts" class="mb-3"></div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                            <tr>
                                <th class="py-3">Item Code</th>
                                <th class="py-3">Name</th>
                                <th class="py-3">Unit Price</th>
                                <th class="py-3">Qty On Hand</th>
                                <th class="py-3">Actions</th>
                            </tr>
                            </thead>
                            <tbody id="itemTable"></tbody>
                        </table>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <div class="text-muted items-summary">Showing 0 to 0 of 0 entries</div>
                        <nav>
                            <ul class="pagination pagination-sm mb-0"></ul>
                        </nav>
                    </div>
                </div>
            </div>

<!-- Item Modal -->
<div class="modal fade" id="itemModal" tabindex="-1" aria-labelledby="itemModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="itemModalLabel">Add New Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="itemForm">
                    <div class="mb-3">
                        <label for="itemCode" class="form-label">Item Code*</label>
                        <input type="text" class="form-control" id="itemCode" required readonly>
                        <div class="invalid-feedback">Item Code is required</div>
                    </div>
                    <div class="mb-3">
                        <label for="itemName" class="form-label">Name*</label>
                        <input type="text" class="form-control" id="itemName" required>
                        <div class="invalid-feedback">Name is required</div>
                    </div>
                    <div class="mb-3">
                        <label for="itemUnitPrice" class="form-label">Unit Price*</label>
                        <input type="number" step="0.01" min="0" class="form-control" id="itemUnitPrice" required>
                        <div class="invalid-feedback">Price must be >= 0</div>
                    </div>
                    <div class="mb-3">
                        <label for="itemQty" class="form-label">Quantity On Hand*</label>
                        <input type="number" min="0" class="form-control" id="itemQty" required>
                        <div class="invalid-feedback">Quantity must be >= 0</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveItem">Save Item</button>
            </div>
        </div>
    </div>
</div>

<!-- Item Delete Confirmation Modal -->
<div class="modal fade" id="deleteItemConfirmModal" tabindex="-1" aria-labelledby="deleteItemConfirmLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteItemConfirmLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="mb-0">Are you sure you want to delete this item?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteItemBtn">Delete</button>
      </div>
    </div>
  </div>
</div>
        </section>

        <!-- Billing Section -->
        <section id="billing" class="content-section" style="display: none;">
            <h2 class="mb-4">Generate Invoice</h2>

            <div class="row">
                <!-- Invoice Form -->
                <div class="col-lg-8">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white">
                            <h6 class="mb-0">Invoice Details</h6>
                        </div>
                        <div class="card-body">
                            <div id="billingAlerts" class="mb-3"></div>

                            <!-- Invoice Header -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="invoiceNumber" class="form-label">Invoice Number*</label>
                                        <input type="text" class="form-control" id="invoiceNumber" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="invoiceDateTime" class="form-label">Date & Time*</label>
                                        <input type="datetime-local" class="form-control" id="invoiceDateTime">
                                    </div>
                                </div>
                            </div>

                            <!-- Customer Selection -->
                            <div class="mb-4">
                                <label for="customerSearch" class="form-label">Customer*</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="customerSearch" placeholder="Search by customer name or account number">
                                    <button class="btn btn-outline-secondary" type="button" id="searchCustomerBtn">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                                <div id="customerSearchResults" class="list-group mt-2" style="display: none;"></div>
                                <div id="selectedCustomer" class="mt-2" style="display: none;">
                                    <div class="alert alert-info">
                                        <strong>Selected Customer:</strong> <span id="selectedCustomerName"></span>
                                        (<span id="selectedCustomerAccount"></span>)
                                        <button type="button" class="btn-close float-end" id="clearCustomerBtn"></button>
                                    </div>
                                </div>
                            </div>

                            <!-- Item Selection -->
                            <div class="mb-4">
                                <label for="itemSearch" class="form-label">Add Items</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="itemSearch" placeholder="Search by item code or name">
                                    <button class="btn btn-outline-secondary" type="button" id="searchItemBtn">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                                <div id="itemSearchResults" class="list-group mt-2" style="display: none;"></div>
                            </div>

                            <!-- Invoice Items Table -->
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead class="table-light">
                                    <tr>
                                        <th>Item Code</th>
                                        <th>Description</th>
                                        <th>Unit Price</th>
                                        <th>Quantity</th>
                                        <th>Total</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody id="invoiceItemsTable">
                                        <tr id="noItemsRow">
                                            <td colspan="6" class="text-center text-muted">No items added yet</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invoice Summary -->
                <div class="col-lg-4">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white">
                            <h6 class="mb-0">Invoice Summary</h6>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Subtotal:</span>
                                <span id="invoiceSubtotal">$0.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <div class="d-flex align-items-center">
                                    <span class="me-2">Discount:</span>
                                    <div class="input-group" style="width: 80px;">
                                        <input type="number" class="form-control form-control-sm" id="discountRate"
                                               min="0" max="100" step="0.1" value="0" placeholder="0">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                                <span id="invoiceDiscount">-$0.00</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <strong>Total Amount:</strong>
                                <strong class="text-success fs-5" id="invoiceTotal">$0.00</strong>
                            </div>

                            <div class="mt-4">
                                <label for="invoiceNotes" class="form-label">Notes (Optional)</label>
                                <textarea class="form-control" id="invoiceNotes" rows="2" placeholder="Additional notes or terms..."></textarea>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="d-grid gap-2 mt-4">
                                <button class="btn btn-success" id="generateInvoiceBtn">
                                    <i class="bi bi-receipt"></i> Generate Invoice
                                </button>
                                <button class="btn btn-outline-secondary" id="clearInvoiceBtn">
                                    <i class="bi bi-arrow-clockwise"></i> Clear Form
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Manage Orders Section -->
        <section id="orders" class="content-section" style="display: none;">
            <h2 class="mb-4">Manage Orders</h2>

            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h6 class="mb-0">Search Bills</h6>
                    <form class="w-100 mt-3" onsubmit="return false;">
                        <div class="row g-2 align-items-center">
                            <div class="col-12 col-sm-6 col-md-3 col-xl-2">
                                <input id="searchBillNumber" type="text" class="form-control form-control-sm" placeholder="Invoice Number">
                            </div>
                            <div class="col-12 col-sm-6 col-md-3 col-xl-2">
                                <input id="searchBillCustomer" type="text" class="form-control form-control-sm" placeholder="Customer">
                            </div>
                            <div class="col-12 col-sm-6 col-md-3 col-xl-2">
                                <select id="searchBillStatus" class="form-control form-control-sm">
                                    <option value="">All Status</option>
                                    <option value="paid">Paid</option>
                                    <option value="overdue">Overdue</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="col-6 col-md-3 col-xl-2">
                                <input id="searchBillFromDate" type="date" class="form-control form-control-sm" placeholder="From Date">
                            </div>
                            <div class="col-6 col-md-3 col-xl-2">
                                <input id="searchBillToDate" type="date" class="form-control form-control-sm" placeholder="To Date">
                            </div>
                            <div class="col-auto">
                                <button id="searchBillsBtn" class="btn btn-sm btn-outline-secondary" type="button">
                                    <i class="bi bi-search"></i>
                                </button>
                                <button id="clearBillsBtn" class="btn btn-sm btn-outline-secondary ms-1" type="button" title="Clear">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-body">
                    <div id="billAlerts" class="mb-3"></div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                            <tr>
                                <th class="py-3">Invoice #</th>
                                <th class="py-3">Customer</th>
                                <th class="py-3">Date</th>
                                <th class="py-3">Items</th>
                                <th class="py-3">Amount</th>
                                <th class="py-3">Status</th>
                                <th class="py-3">Actions</th>
                            </tr>
                            </thead>
                            <tbody id="billTable">
                                <!-- Sample data -->
                                <tr>
                                    <td>2024-01-00001</td>
                                    <td>John Doe (ACC0001)</td>
                                    <td>2024-01-15 10:30 AM</td>
                                    <td>3 items</td>
                                    <td>$1,250.00</td>
                                    <td><span class="badge bg-success">Paid</span></td>
                                    <td class="text-nowrap">
                                        <button class="btn btn-sm btn-outline-primary me-1" title="View Invoice">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info me-1" title="Print Invoice">
                                            <i class="bi bi-printer"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary me-1" title="Send Email">
                                            <i class="bi bi-envelope"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-1" title="Mark as Paid">
                                            <i class="bi bi-check-circle"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>2024-01-00002</td>
                                    <td>Jane Smith (ACC0002)</td>
                                    <td>2024-01-18 02:15 PM</td>
                                    <td>2 items</td>
                                    <td>$850.00</td>
                                    <td><span class="badge bg-warning">Sent</span></td>
                                    <td class="text-nowrap">
                                        <button class="btn btn-sm btn-outline-primary me-1" title="View Invoice">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info me-1" title="Print Invoice">
                                            <i class="bi bi-printer"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary me-1" title="Send Email">
                                            <i class="bi bi-envelope"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-1" title="Mark as Paid">
                                            <i class="bi bi-check-circle"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>2024-01-00003</td>
                                    <td>Mike Johnson (ACC0003)</td>
                                    <td>2024-01-20 11:45 AM</td>
                                    <td>1 item</td>
                                    <td>$320.00</td>
                                    <td><span class="badge bg-danger">Overdue</span></td>
                                    <td class="text-nowrap">
                                        <button class="btn btn-sm btn-outline-primary me-1" title="View Invoice">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info me-1" title="Print Invoice">
                                            <i class="bi bi-printer"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary me-1" title="Send Email">
                                            <i class="bi bi-envelope"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-1" title="Mark as Paid">
                                            <i class="bi bi-check-circle"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <div class="text-muted bills-summary">Showing 1 to 3 of 3 entries</div>
                        <nav>
                            <ul class="pagination pagination-sm mb-0">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item disabled">
                                    <a class="page-link" href="#">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </section>

        <!-- Help Section -->
        <section id="help" class="content-section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">Help Center</h2>
            </div>
            <div class="col-lg-4 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white">
                        <h6 class="mb-0">Getting Started Guide</h6>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="gettingStartedAccordion">

                            <!-- 1. Login -->
                            <div class="accordion-item border-0">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#guideLogin">
                                        <i class="bi bi-box-arrow-in-right me-2"></i> Login to the Portal
                                    </button>
                                </h2>
                                <div id="guideLogin" class="accordion-collapse collapse" data-bs-parent="#gettingStartedAccordion">
                                    <div class="accordion-body small">
                                        Enter your <b>username</b> and <b>password</b> on the login screen. Only authenticated users can access the admin panel.
                                    </div>
                                </div>
                            </div>

                            <!-- 2. Dashboard -->
                            <div class="accordion-item border-0">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#guideDashboard">
                                        <i class="bi bi-speedometer2 me-2"></i> Dashboard Overview
                                    </button>
                                </h2>
                                <div id="guideDashboard" class="accordion-collapse collapse" data-bs-parent="#gettingStartedAccordion">
                                    <div class="accordion-body small">
                                        View a quick summary of <b>Total Revenue</b>, <b>Customers</b>, <b>Orders</b>, and <b>Active Items</b>. Use this for daily monitoring.
                                    </div>
                                </div>
                            </div>

                            <!-- 3. Customers -->
                            <div class="accordion-item border-0">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#guideCustomers">
                                        <i class="bi bi-people-fill me-2"></i> Managing Customers
                                    </button>
                                </h2>
                                <div id="guideCustomers" class="accordion-collapse collapse" data-bs-parent="#gettingStartedAccordion">
                                    <div class="accordion-body small">
                                        Add new customers with details like <b>Account No, Name, Email, Phone, and Address</b>.
                                        You can search, view, update, or delete customer records anytime.
                                    </div>
                                </div>
                            </div>

                            <!-- 4. Items -->
                            <div class="accordion-item border-0">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#guideItems">
                                        <i class="bi bi-box-seam me-2"></i> Managing Items
                                    </button>
                                </h2>
                                <div id="guideItems" class="accordion-collapse collapse" data-bs-parent="#gettingStartedAccordion">
                                    <div class="accordion-body small">
                                        Add, edit, and track products. Each item includes <b>Item Code, Name, Price, and Quantity</b>.
                                        Use search filters to quickly find stock by code, price range, or quantity.
                                    </div>
                                </div>
                            </div>

                            <!-- 5. Billing -->
                            <div class="accordion-item border-0">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#guideBilling">
                                        <i class="bi bi-receipt me-2"></i> Creating Invoices
                                    </button>
                                </h2>
                                <div id="guideBilling" class="accordion-collapse collapse" data-bs-parent="#gettingStartedAccordion">
                                    <div class="accordion-body small">
                                        Generate invoices by selecting a <b>customer</b> and adding <b>items</b>.
                                        Apply discounts, add notes, and review totals before finalizing.
                                        Invoices can be saved, printed, or emailed directly.
                                    </div>
                                </div>
                            </div>

                            <!-- 6. Orders -->
                            <div class="accordion-item border-0">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#guideOrders">
                                        <i class="bi bi-cart-check me-2"></i> Managing Orders
                                    </button>
                                </h2>
                                <div id="guideOrders" class="accordion-collapse collapse" data-bs-parent="#gettingStartedAccordion">
                                    <div class="accordion-body small">
                                        Track all invoices and their status (<b>Paid, Sent, Overdue, or Cancelled</b>).
                                        Options include viewing, printing, emailing, or marking orders as paid.
                                    </div>
                                </div>
                            </div>

                            <!-- 7. Help -->
                            <div class="accordion-item border-0">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#guideHelp">
                                        <i class="bi bi-question-circle me-2"></i> Help & Support
                                    </button>
                                </h2>
                                <div id="guideHelp" class="accordion-collapse collapse" data-bs-parent="#gettingStartedAccordion">
                                    <div class="accordion-body small">
                                        Visit the <b>Help Center</b> for FAQs, export guides, and permission settings.
                                        Access <b>Documentation, Video Tutorials, Community Forum</b>, or contact <b>Email Support</b>.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

<!-- Customer Registration Modal -->
<div class="modal fade" id="customerModal" tabindex="-1" aria-labelledby="customerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="customerModalLabel">Add New Customer</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="customerForm">
                    <div class="mb-3">
                        <label for="accountNo" class="form-label">Account Number*</label>
                        <input type="text" class="form-control" id="accountNo" required readonly>
                        <div class="invalid-feedback">Account No is required</div>
                    </div>
                    <div class="mb-3">
                        <label for="customerName" class="form-label">Full Name*</label>
                        <input type="text" class="form-control" id="customerName" required>
                        <div class="invalid-feedback">Name is required</div>
                    </div>
                    <div class="mb-3">
                        <label for="customerEmail" class="form-label">Email*</label>
                        <input type="email" class="form-control" id="customerEmail" required pattern=".*@.*">
                        <div class="invalid-feedback">Please enter a valid email address</div>
                    </div>
                    <div class="mb-3">
                        <label for="customerPhone" class="form-label">Phone</label>
                        <input type="tel" class="form-control" id="customerPhone" maxlength="10" inputmode="numeric" pattern="[0-9]{10}">
                        <div class="invalid-feedback">Phone must be exactly 10 digits</div>
                    </div>
                    <div class="mb-3">
                        <label for="customerAddress" class="form-label">Address</label>
                        <textarea class="form-control" id="customerAddress" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveCustomer">Save Customer</button>
            </div>
        </div>
    </div>
</div>

<!-- Customer Delete Confirmation Modal -->
<div class="modal fade" id="customerDeleteConfirmModal" tabindex="-1" aria-labelledby="customerDeleteConfirmLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="customerDeleteConfirmLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="mb-0">Are you sure you want to delete this customer?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmCustomerDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Bill Delete Confirmation Modal -->
<div class="modal fade" id="billDeleteConfirmModal" tabindex="-1" aria-labelledby="billDeleteConfirmLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="billDeleteConfirmLabel">Confirm Bill Deletion</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmBillDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Customer Preview Modal -->
<div class="modal fade" id="customerViewModal" tabindex="-1" aria-labelledby="customerViewLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="customerViewLabel">Customer Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <div class="mb-2"><span class="text-muted small">Name</span><div class="fw-semibold" id="viewCustomerName">-</div></div>
            <div class="mb-2"><span class="text-muted small">Account No</span><div class="fw-semibold" id="viewCustomerAccount">-</div></div>
            <div class="mb-2"><span class="text-muted small">Email</span><div class="fw-semibold" id="viewCustomerEmail">-</div></div>
            <div class="mb-2"><span class="text-muted small">Phone</span><div class="fw-semibold" id="viewCustomerPhone">-</div></div>
            <div class="mb-0"><span class="text-muted small">Address</span><div class="fw-semibold" id="viewCustomerAddress">-</div></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Logout Confirmation Modal -->
<div class="modal fade" id="logoutModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title" id="logoutModalLabel">Confirm Logout</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center py-4">
                <i class="bi bi-question-circle text-primary" style="font-size: 3rem;"></i>
                <h5 class="mt-3">Are you sure you want to logout?</h5>
                <p class="text-muted">You'll need to sign in again to access the admin panel.</p>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger px-4" id="confirmLogout">
                    <i class="bi bi-box-arrow-right me-2"></i>Logout
                </button>
            </div>
        </div>
    </div>
</div>

<script src="js/BillingController.js"></script>
<script src="js/BillManagementController.js"></script>
<script src="js/CustomerController.js"></script>
<script src="js/ItemController.js"></script>
<script src="js/CommonController.js"></script>
<script src="js/DashboardController.js"></script>
<script>
// Check authentication state on page load
document.addEventListener('DOMContentLoaded', function() {
    // Check if user is already logged in
    checkAuthStatus();
    
        // Initialize logout functionality
    const logoutBtn = document.getElementById('logoutBtn');
    const confirmLogoutBtn = document.getElementById('confirmLogout');
    let logoutModal = null;
    
    // Function to show logout modal
    function showLogoutModal() {
        // Initialize modal if not already done
        if (!logoutModal) {
            const modalElement = document.getElementById('logoutModal');
            if (modalElement) {
                logoutModal = new bootstrap.Modal(modalElement, {
                    backdrop: 'static', // Prevent closing when clicking outside
                    keyboard: false     // Prevent closing with ESC key
                });
            }
        }
        
        // Show the modal
        if (logoutModal) {
            logoutModal.show();
        }
    }
    
    // Add click handler for logout button
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            showLogoutModal();
            return false;
        });
    }
    
    // Handle confirm logout button click
    if (confirmLogoutBtn) {
        confirmLogoutBtn.addEventListener('click', function() {
            // Hide the modal
            if (logoutModal) {
                logoutModal.hide();
            }
            
            // Proceed with logout
            handleLogout();
        });
    }
});

// Check if user is authenticated
async function checkAuthStatus() {
    try {
        const response = await fetch('api/auth/status', { credentials: 'same-origin' });
        const data = await response.json();
        
        if (data.authenticated) {
            document.body.classList.add('authenticated');
            // If on login page, redirect to dashboard
            if (window.location.hash === '#login') {
                window.location.hash = 'dashboard';
            }
        } else {
            document.body.classList.remove('authenticated');
            // If not on login page, redirect to login
            if (window.location.hash !== '#login') {
                window.location.hash = 'login';
            }
        }
    } catch (error) {
        console.error('Error checking auth status:', error);
        // If there's an error, assume not authenticated
        document.body.classList.remove('authenticated');
        window.location.hash = 'login';
    }
}

// Handle login form submission
async function handleLogin(event) {
    event.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const errorElement = document.getElementById('loginError');
    
    try {
        const formData = new URLSearchParams();
        formData.append('username', username);
        formData.append('password', password);
        
        const response = await fetch('api/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            credentials: 'same-origin',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            document.body.classList.add('authenticated');
            window.location.hash = data.redirect || 'dashboard';
        } else {
            errorElement.textContent = data.message || 'Login failed';
            errorElement.style.display = 'block';
        }
    } catch (error) {
        console.error('Login error:', error);
        errorElement.textContent = 'An error occurred during login';
        errorElement.style.display = 'block';
    }
}

// Handle logout
async function handleLogout() {
    try {
        const response = await fetch('api/auth/logout', {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        });
        
        const data = await response.json();
        if (data.success) {
            // Remove authenticated class
            document.body.classList.remove('authenticated');
            
            // Clear any existing data
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            // Hide any error messages
            const errorElement = document.getElementById('loginError');
            if (errorElement) errorElement.style.display = 'none';
            
            // Force a hard redirect to ensure clean state
            window.location.href = window.location.pathname + '#login';
            window.location.reload();
        }
    } catch (error) {
        console.error('Logout error:', error);
        // Even if there's an error, still redirect to login
        window.location.href = window.location.pathname + '#login';
        window.location.reload();
    }
}

// Handle hash changes for SPA navigation
window.addEventListener('hashchange', function() {
    // If trying to access protected routes without authentication
    if (window.location.hash !== '#login' && !document.body.classList.contains('authenticated')) {
        window.location.hash = 'login';
    }
    
    // Highlight active navigation link
    document.querySelectorAll('.sidebar-menu a').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === window.location.hash) {
            link.classList.add('active');
        }
    });
});
</script>

</div> <!-- Close content div -->
</div> <!-- Close loginOverlay div -->
</body>
</html>